<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>音频 &lt;audio&gt;</title>
  <link rel="stylesheet" href="../css/common.css">
  <link rel="stylesheet" href="./css/audio.css">
  <base target="_blank">
</head>

<body>
  <header>
    <h1>音频</h1>
    <span>&lt;audio&gt;</span>
    <span class="ham iconfont icon-menu"></span>
    <nav class="nav">
      <a href="" style="--delay:0" class="nav-item">概述</a>
      <a href="" style="--delay:1" class="nav-item">H5属性</a>
      <a href="" style="--delay:2" class="nav-item">媒体属性</a>
      <a href="" style="--delay:3" class="nav-item">媒体事件</a>
    </nav>
  </header>
  <dl>
    <dt>素材准备</dt>
    <dd><span class="iconfont icon-layer-group"></span> 点击下载素材 <a href="/utils/music/Alizee-LaIslaBonita.mp3"
        download>Alizee-La Isla Bonita.mp3</a> 或自行准备</dd>
    <dt class="nav-cont">概述</dt>
    <dd>
      <div>. 行盒 inline；<a href="https://developer.mozilla.org/en-US/docs/Web/CSS/Replaced_element">可替换元素 - replaced
          element</a>，同 &lt;img&gt;；可以设置大小</div>
      <div>. 播放音频文件，如.mp3、.ogg、.wav</div>
      <div>. 默认情况下，只有 src 属性，音频元素不可见，应该通过 JavaScript 访问控制</div>
      <pre>&lt;audio src=""&gt;&lt;/audio&gt;</pre>
      <div>. 指定播放控制属性 controls，则可以可视化控制</div>
      <pre>&lt;audio src="" controls&gt;&lt;/audio&gt;</pre>
      <div>. 可以使用多个 &lt;source&gt; 指定音频，浏览器自动选择并播放最合适的源</div>
      <div>. 通用格式 vs 专有格式</div>
      <pre>
&lt;audio controls&gt;
  &lt;source src="myAudio.mp3" type="audio/mpeg" /&gt;
  &lt;source src="myAudio.ogg" type="audio/ogg" /&gt;
&lt;/audio&gt;</pre>
      <div>使用建议1：内嵌 &lt;a&gt; ；如果系统无法识别，触发下载</div>
      <pre>
&lt;audio src="AudioTest.ogg" autoplay&gt;
  &lt;a href="AudioTest.ogg" download="AudioTest.ogg"&gt;Download OGG audio&lt;/a&gt;.
&lt;/audio&gt;      </pre>
      <div>使用建议2：使用提示文本；当浏览器不支持此标签时，显示提示内容</div>
      <pre>
&lt;audio src="AudioTest.ogg" autoplay&gt;  您的浏览器不支持audio标签 &lt;/audio&gt;      </pre>
      <div>. 更多信息，请访问 <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/audio">MDN -
          &lt;audio&gt;</a>、<a href="https://mp.weixin.qq.com/s/1mMEXKzXHTl2eHJEXi-8PA">HTML5 向网页嵌入视频和音频</a>、<a
          href="https://css-tricks.com/lets-create-a-custom-audio-player/">custom-audio-player</a>
      </div>
    </dd>
    <dt class="nav-cont">HTML属性</dt>
    <dd>
      <table class="">
        <tr>
          <th>类别</th>
          <th>说明</th>
        </tr>
        <tr>
          <td>src</td>
          <td>音频的URL，推荐使用MP3格式</td>
        </tr>
        <tr>
          <td>autoplay</td>
          <td>自动播放；布尔属性</td>
        </tr>
        <tr>
          <td>controls</td>
          <td>播放控制条；布尔属性</td>
        </tr>
        <tr>
          <td>loop</td>
          <td>重复播放；布尔属性</td>
        </tr>
        <tr>
          <td>muted</td>
          <td>静音播放；布尔属性</td>
        </tr>
        <tr>
          <td>preload</td>
          <td>预加载；如果使用autoplay，则忽略该属性</td>
        </tr>
        <tr>
          <td>hidden</td>
          <td>隐藏；同display: none;隐藏后，仍然可以使用js控制!!!</td>
        </tr>
      </table>
    </dd>
    <dd>[<span class="iconfont icon-keyboard"></span>] 自动背景音乐 - 页面加载后自动循环播放，且隐藏</dd>
    <dd>. 优点：简单直接</dd>
    <dd>. 缺点：用户体验差，参与度低，不方便个性化定制</dd>
    <dd>
      <pre>
&lt;audio src="./mp3/Alizee-La Isla Bonita.mp3" autoplay loop hidden&gt;您的浏览器不支持audio标签&lt;/audio&gt;</pre>
    </dd>
  </dl>
  <div class="chap">进阶使用 Advanced</div>
  <dl>
    <dt class="nav-cont">媒体属性</dt>
    <dd>
      <div>. 使用 JavaScript 控制</div>
      <div>. 大多属性和HTML标签属性一一对应；此外还有</div>
      <table class="">
        <tr>
          <th>类别</th>
          <th>说明</th>
        </tr>
        <tr>
          <td>autoplay</td>
          <td>设置或返回是否在就绪（加载完成）后随即播放音频</td>
        </tr>
        <tr>
          <td><span class="warn">currentTime</span></td>
          <td>设置或返回音频中的当前播放位置；以秒计）</td>
        </tr>
        <tr>
          <td>ended</td>
          <td>返回音频的播放是否已结束</td>
        </tr>
        <tr>
          <td>muted</td>
          <td>设置或返回是否关闭声音</td>
        </tr>
        <tr>
          <td>paused</td>
          <td>设置或返回音频是否暂停</td>
        </tr>
        <tr>
          <td>played</td>
          <td>播放状态；返回表示音频已播放部分的 TimeRanges 对象</td>
        </tr>
        <tr>
          <td>src</td>
          <td>设置或返回音频的 src 属性的值</td>
        </tr>
        <tr>
          <td>volume</td>
          <td>设置或返回音频的音量： 0.0（静音）- 1.0（最大声）</td>
        </tr>
      </table>
    </dd>
    <dt class="nav-cont">媒体事件</dt>
    <dd>
      <div>. 媒体在加载和使用中的各种事件，用于监听音频的播放</div>
      <table class="">
        <tr>
          <th>类别</th>
          <th>说明</th>
        </tr>
        <tr>
          <td>Audio()</td>
          <td>构造方法；创建一个不可视的音频组件，如播放背景</td>
        </tr>
        <tr>
          <td>loadstart</td>
          <td>开始加载</td>
        </tr>
        <tr>
          <td>durationchange</td>
          <td>时长发生变化触发；加载完毕后，从NaN变为实际的数值</td>
        </tr>
        <tr>
          <td>loadedmetadata</td>
          <td>加载元数据：时长、尺寸大小（视频）、文本轨道等等</td>
        </tr>
        <tr>
          <td>loadeddata</td>
          <td>当前帧的数据加载完毕，下一帧还未就绪</td>
        </tr>
        <tr>
          <td>progress</td>
          <td>媒体正在下载中</td>
        </tr>
        <tr>
          <td>canplay</td>
          <td>媒体就绪，可以播放</td>
        </tr>
        <tr>
          <td>canplaythrough</td>
          <td>媒体就绪，可以正常播放且无需停顿和缓冲</td>
        </tr>
        <tr>
          <td>play</td>
          <td>播放</td>
        </tr>
        <tr>
          <td>pause</td>
          <td>暂停</td>
        </tr>
      </table>
    </dd>
    <dd>.&lt;audio&gt;的媒体事件触发顺序为</dd>
    <dd class="sn">
      <div> loadstart </div>
      <div> durationchange</div>
      <div> loadedmetadata - 可以获取 duration</div>
      <div> loadeddata</div>
      <div> progress</div>
      <div> canplay</div>
      <div> canplaythrough</div>
      <div>ended</div>
    </dd>
    <dd>更多信息，请访问 <a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLMediaElement">MDN - HTMLMediaElement</a>
    </dd>
    <dt>辅助函数</dt>
    <dd>
      <div>. 获取的时间通常要转化为一定的格式，如 mm:ss，参考代码如下</div>
      <pre>
function time(secs) {
  let min = Math.floor(secs / 60);
  let sec = Math.floor(secs % 60);
  let secRes = sec > 9 ? `${sec}` : `0${sec}`;
  let minRes = min > 9 ? `${min}` : `0${min}`;
  return `${minRes}:${secRes}`;
}</pre>
    </dd>
    <dd>[<span class="iconfont icon-keyboard"></span>] 可控背景音乐 - 用户可以停止或播放</dd>
    <dd class="sn">
      <div>Html</div>
      <pre>
&lt;button id="play"&gt;play&lt;/button&gt;
&lt;button id="stop"&gt;stop&lt;/button&gt;
&lt;audio src="Alizee.mp3"&gt;&lt;/audio&gt;</pre>
      <div>CSS：自行完成 UI 设计</div>
      <div>JavaScript：在 &lt;body&gt; 区末尾添加 &lt;script&gt; 并完成 JavaScript 逻辑：获取元素；点击播放或暂停</div>
      <pre>
const audio = document.getElementById('audio');
const play = document.getElementById('play');
const pause = document.getElementById('pause');
play.addEventListener('click', function () {
  audio.play();
})
pause.addEventListener('click', function () {
  audio.pause();
})      </pre>
      <p>或</p>
      <pre>
let playBtn = document.querySelector('#play-btn');
let stopBtn = document.querySelector('#stop-btn');
let audioBg = document.querySelector('#audio-bg');
playBtn.onclick = function () {
  audioBg.play();
}
stopBtn.onclick = function () {
  audioBg.pause();
}</pre>
    </dd>
    <dd>[<span class="iconfont icon-keyboard"></span>] 进阶可控背景音乐</dd>
    <dd>
      <div>. 利用 Audio 构造函数生成音频实例，并指定 src</div>
      <div>. H5 仅仅控制播放；音频由 Audio 类构造函数new一个音频对象；CSS 样式自定</div>
      <div>. 除了根据音频属性 paused 状态判断是否暂停外，还可以根据元素文字判断，或者根据类判断[如果使用属性 played 判断。。。</div>
      <div>. 除了文字外，还可以使用图片或字体图标设计 UI</div>
      <pre>
let switch = document.querySelector('.switch')
let bg = new Audio();
bg.src = '/music/Alizee-La Isla Bonita.mp3'
bg.pause();
switch.addEventListener('click', () => {
    if (bg.paused) {
        switch.innerHTML = 'on'
        bg.play();
    } else {
        switch.innerHTML = 'off'
        bg.pause();
    }
    switch.classList.toggle('active')
})</pre>
    </dd>
    <dd>[<span class="iconfont icon-keyboard"></span>] MINI音乐播放器1</dd>
    <dd class="custom-audio">
      <audio id='audio'>您的浏览器不支持audio标签</audio>
      <span>Alizee-La Isla Bonita</span>
      <div class="cur">00:00</div>
      <div id="ctrl" class="play"></div>
      <div class="dur">00:00</div>
    </dd>
    <dd class="sn">
      <div>使用 &lt;audio&gt; 元素构造函数创建音频对象并指定 src</div>
      <div>根据设计创建播放列表样式，包括资源说明和控制按钮</div>
      <div>根据播放状态切换控制按钮为播放按钮或暂停按钮</div>
      <div>利用js事件控制 &lt;audio&gt; 的播放和暂停</div>
      <div>根据当前播放时长 currentTime 和总时长 duration，获取播放进度百分比，设置元素的内联变量 --per 属性，并由其伪元素使用，设置相应的百分比进度条</div>
      <pre>
&lt;div class="custom-audio"&gt;
  &lt;audio id='audio'&gt;您的浏览器不支持audio标签&lt;/audio&gt;
  &lt;span&gt;Alizee-La Isla Bonita&lt;/span&gt;
  &lt;div class="cur"&gt;00:00&lt;/div&gt;
  &lt;div id="ctrl" class="play"&gt;&lt;/div&gt;
  &lt;div class="dur"&gt;00:00&lt;/div&gt;
&lt;/div&gt;</pre>
      <pre>
.custom-audio {
    --per: 0%;
    position: relative;
    //...
}
.custom-audio::before {
  content: '';
  position: absolute;
  left: 0;
  bottom: 0px;
  width: var(--per);
  height: 2px;
  background-color: var(--warn-color);
}
#ctrl {
    width: 20px;
    height: 20px;
    background-size: cover;
    cursor: pointer;
}
.play {
    background-image: url(../imgs/Play.png);
}
.pause {
    background-image: url(../imgs/Pause.png);
}</pre>
      <div>JavaScript：这里利用控制按钮的类名[更改背景图片]判断播放状态，也可以通过定义 bool 变量判断</div>
      <pre>
let audio = new Audio();
audio.src = '/music/Alizee-La Isla Bonita.mp3';
let tag = document.querySelector('.custom-audio');
let ctrl = document.querySelector('#ctrl');
let cur = document.querySelector('.cur');
let dur = document.querySelector('.dur');

audio.addEventListener('loadedmetadata', () => {
  dur.innerHTML = time(audio.duration);
})

audio.addEventListener('timeupdate', () => {
  let secs = audio.currentTime;
  cur.innerHTML = time(audio.currentTime);
  let per = (audio.currentTime / audio.duration) * 100 + '%';
  tag.style.setProperty('--per', per);
})

audio.addEventListener('click', function () {
  ctrl.click()
})

ctrl.addEventListener('click', function () {
  if (ctrl.className == 'play') {
    audio.play()
    ctrl.className = 'pause'
  } else {
    audio.pause()
    ctrl.className = 'play'
  }
})</pre>
    </dd>
    <dd>[<span class="iconfont icon-keyboard"></span>] <a href="./demo/miniplayer.html">MINI音乐播放器2</a></dd>
    <dd>[<span class="iconfont icon-keyboard"></span>] <a href="./demo/player.html">MINI音乐播放器3</a> - 无CSS</dd>
  </dl>
  <div class="chap">总结与作业 Summary & Homework</div>
  <dl>
    <dt>总结 Summary</dt>
    <dd>. 音频的使用和定制</dd>
    <dd class="tips">
      <div>谨慎使用背景音乐</div>
      <div>为了首页加载速度，通常不直接在主页放置音频/视频；而是通过超链接的方式转到单独的页面播放</div>
      <div>JavaScript 控制时，不允许未经任何交互直接播放：play() failed because the user didn't interact with the document first.</div>
    </dd>
    <dt>作业 Homework</dt>
    <dd class="sn">
      <div>分别使用可视化控制和js控制实现背景音乐的播放</div>
      <div>定制音乐开关按钮</div>
      <div>定制音乐播放列表</div>
      <div>扩充并完善到个人网站</div>
    </dd>
  </dl>
  <iframe src="../../common/footer.html" frameborder="0" scrolling="no" title="footer" id="footer"></iframe>
  <script src="/utils/custom/ham2024.js"></script>
  <script>
    // player
    let audio = new Audio();
    audio.src = '../utils/music/Alizee-LaIslaBonita.mp3';
    let tag = document.querySelector('.custom-audio');
    let ctrl = document.querySelector('#ctrl');
    let cur = document.querySelector('.cur');
    let dur = document.querySelector('.dur');
    audio.addEventListener('loadedmetadata', () => {
      dur.innerHTML = time(audio.duration);
    })
    audio.addEventListener('timeupdate', () => {
      let secs = audio.currentTime;
      cur.innerHTML = time(audio.currentTime);
      let per = (audio.currentTime / audio.duration) * 100 + '%';
      tag.style.setProperty('--per', per);
    })
    audio.addEventListener('click', function () {
      ctrl.click()
    })
    ctrl.addEventListener('click', function () {
      if (ctrl.className == 'play') {
        audio.play()
        ctrl.className = 'pause'
      } else {
        audio.pause()
        ctrl.className = 'play'
      }
    })
    function time(secs) {
      let min = Math.floor(secs / 60);
      let sec = Math.floor(secs % 60);
      let secRes = sec > 9 ? `${sec}` : `0${sec}`;
      let minRes = min > 9 ? `${min}` : `0${min}`;
      return `${minRes}:${secRes}`;
    }
  </script>
</body>

</html>