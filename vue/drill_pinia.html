<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>实训 状态综合运用</title>
  <link rel="stylesheet" href="../css/exp.css">

  <base target="_blank">
</head>

<body>
  <header>
  </header>
  <div class="container">
    <h1>状态综合运用</h1>
    <h4>Pinia</h4>
    <div class="title">实验题目</div>
    <div class="cont">仓库设计</div>
    <div class="title">实验目的</div>
    <div class="cont">
      <div>掌握状态管理|仓库 Pinia 的基本使用</div>
      <div>熟悉开发者工具 Vue Devtools 的基本使用</div>
      <div>进一步熟悉路由的基本使用</div>
    </div>
    <div class="title">实验内容</div>
    <div class="cont">
      <p>改写前续产品列表页 Goods.vue 和 产品详情页 Details.vue，使用仓库完成数据的处理</p>
      <div>商品仓库 goods.js</div>
      <p>. 所有商品 goods</p>
      <p>. 单个商品 good</p>
      <p>. 获取所有商品 getGoods()</p>
      <p>. 根据 id 获取商品 getGoodById()</p>
      <p>. 分页获取商品* getGoodsByPage()</p>
      <p>. 其它业务*</p>
      <div>购物车仓库 cart.js</div>
      <p>. 购物车数据 cart</p>
      <P>. 获取购物车数据 getCart()</P>
      <p>. 添加到购物车 addToCart()</p>
      <p>. 从购物车中删除 removeFromCart()</p>
      <p>. 清空购物车 clearCart()</p>
      <p>. 其它业务*</p>
      <div>主题切换/换肤* theme.js</div>
      <div>汉堡菜单* ham.js</div>
      <div>地图仓库* map.js</div>
      <div>订单仓库* order.js</div>
    </div>
    <div id="drill"></div>
    <div class="title">参考效果和参考代码</div>
    <div class="cont">
      <div>商品仓库 goods.js</div>
      <p>. 在仓库目录 stores 创建商品仓库 goods.js</p>
      <pre>
import { ref, computed } from "vue";
import { defineStore } from "pinia";

export const useGoodsStore = defineStore("goods", () => {
  const goods = ref([]);
  const good = ref({});

  const getGoods = async () => {
    // 获取商品数据；方法来源可自定；这里以大树小站数据
    let res = await fetch("https://glpla.github.io/utils/data/coffee.json")
    let json = await res.json()
    // 更新状态
    goods.value = json.cont;
    // 显式返回结果，便于组件使用
    return json.cont;
  };

  const getGoodById = async (id) => {
    // 如果第一次使用仓库，则先获取商品数据
    if (goods.value.length === 0) {
      await getGoods();
    }
    // 注意 === 的限制；如果定义的id是普通数值0，则可能匹配失败，因为所有的参数都是字符串类型；'0' === 0，为假
    let res = goods.value.find((good) => good.id == id);
    // 更新状态
    good.value = res;
    // 显式返回结果，便于组件使用
    return res;
  };

  return { goods, good, getGoods, getGoodById };
});</pre>
      <div>购物车仓库 cart.js</div>
      <p>. 在仓库目录 stores 创建购物车仓库 cart.js</p>
      <!-- <pre>
import { ref } from "vue";
import { defineStore } from "pinia";

export const useCartStore = defineStore("cart", () => {
  const cart = ref([]);

  const addToCart = (product) => {
    // 直接添加到购物车，增加数量字段，默认为1
    // const existingItem = cart.value.find((item) => item.id === product.id);
    // if (existingItem) {
    //   existingItem.quantity++;
    //   console.log("++");
    // } else {
    //   cart.value.push({ ...product, quantity: 1 });
    //   console.log("1");
    // }

    // 从详情页添加到购物车，数据已经进行了预处理，数量默认为1
    const res = cart.value.filter((item) => item.id === product.id)[0];
    if (res) {
      res.quantity += product.quantity;
    } else {
      cart.value.push({ ...product });
    }
  };

  const removeFromCart = (id) => {
    cart.value = cart.value.filter((item) => item.id !== id);
  };

  const getCart = async () => {
    let response = await fetch("../data/cart.json");
    let data = await response.json();
    cart.value = data;
  };

  const clearCart = () => {
    cart.value = [];
  };

  return {
    cart,
    addToCart,
    removeFromCart,
    getCart,
    clearCart,
  };
});</pre> -->
      <div>其它仓库</div>
    </div>
    <div class="title">拓展与思考</div>
    <div class="cont">
      <div>库存调整：商品数量变化的同时，相应的调整库存</div>
      <div>加载指示：加载仓库数据时，给出加载提示，如：数据加载中...</div>
      <div>使用 supabase 中数据库/表格改进并优化数据的管理</div>
      <div>保存/推送项目到自己的代码仓库*</div>
    </div>
    <div id="footer"></div>
  </div>
  <script src="/utils/custom/footer.js"></script>
  <script src="/utils/custom/drill-vue.js"></script>
  <script src="/utils/custom/star.js"></script>
</body>

</html>