<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>路由 Router</title>
    <link rel="stylesheet" href="../css/reset2024.css">
    <link rel="stylesheet" href="../css/common2024.css">
    <link rel="stylesheet" href="../css/code.css">
    <link rel="stylesheet" href="../css/sn.css">
    <base target="_blank">
</head>

<body>
    <header>
        <h1>路由</h1>
        <span>Router</span>
    </header>
    <dl class="nav-cont">
        <dt>概述</dt>
        <dd>按照路径path和组件component的值对形式name-value定义路由</dd>
        <dd>每一个组件都是一个单组件文件SCF，后缀名是.vue；引入组件时，可以省略后缀名</dd>
        <dd>必须指定路由工作模式history</dd>
        <dd>所有的路由配置位于项目文件夹src → router中，通常是index.js</dd>
        <dd>路由组件应该集中、分类存放，如pages文件夹、views文件夹等视图类文件夹；其它一般组件则存放于components文件夹</dd>
        <dd>更多信息，请访问<a href="https://router.vuejs.org/zh/" class="link">Vue Router</a></dd>
        <dt>安装路由</dt>
        <dd>可以创建项目的时候指定使用路由，自动生成路由配置文件，推荐 <i class="ri-thumb-up-fill"></i></dd>
        <dd>也可以单独安装路由依赖；需要单独配置并引入，比较麻烦，不推荐</dd>
        <dd>
            <figure class="code">
                <figcaption>安装路由</figcaption>
                <pre>npm i vue-router</pre>
            </figure>
        </dd>
        <dt>声明路由</dt>
        <dd>
            <figure class="code">
                <figcaption>在入口js中引入并声明路由</figcaption>
                <pre>
//引入
import router from './router'

//使用 - 链式
app.use(router).mount('#app')</pre>
            </figure>
        </dd>
        <dt>定义路由</dt>
        <dd>路由必须指定path和component</dd>
        <dd>还可以使用属性定义其它类型路由，见下表</dd>
        <dd>
            <table class="tbl-sn">
                <caption>常见路由分类</caption>
                <tr>
                    <th>路由</th>
                    <th>说明</th>
                    <th>属性</th>
                </tr>
                <tr>
                    <td>命名路由</td>
                    <td>通过名字来使用路由；更直观、灵活；如多级路由</td>
                    <td>name</td>
                </tr>
                <tr>
                    <td>重定向路由</td>
                    <td>让指定的路由重新定位到另外一个路由</td>
                    <td>redirect</td>
                </tr>
                <tr>
                    <td>嵌套路由</td>
                    <td>子路由；<br>path可以省略父级路由；或使用携带父级路由的完整路由</td>
                    <td>children</td>
                </tr>
                <tr>
                    <td>404路由</td>
                    <td>使用自定义的 路径参数 正则表达式匹配其它任意路径，如404路由；<br> 通常是最后一个路由配置项</td>
                    <td></td>
                </tr>
            </table>
        </dd>
        <dd>
            <figure class="code">
                <figcaption>路由文件index.js配置详情</figcaption>
                <pre>
//引入路由包
import {createRouter, createWebHistory} from 'vue-router'

//引入路由组件Home；其它组件可以按需导入
import Home from '@/pages/Home'

//创建|定义路由
const router = createRouter({
    history: createWebHistory(),
    routes : [
        {
            path: '/',
            component: Home
        },
        {
            path: '/home',
            redirect: '/'
        },
        {
            path: '/work',
            component: () => import('../components/sub_view/Work.vue'),
            children:[
                {
                    path: ' ',//省略父级路由
                    name: "html5",
                    component: Html5
                },
                {
                    path: 'css3',//省略父级路由
                    name: "css3",
                    component: CSS3
                },
                {
                    path: '/work/js',//使用完整路由
                    name: "js",
                    component: JavaScript
                }
            ]
        },
        {
            path: '/team',
            component: () => import('../components/sub_view/Team.vue')
        },
        {
            path: '/about',
            component: () => import('../components/sub_view/About.vue')
        },
        {
            path: '/:pathMatch(.*)*',
            name: 'not-found',
            component: () => import('../views/NotFound.vue')
        }
    ]
})

//导出路由
export default router
</pre>
            </figure>
        </dd>
        <dt>使用路由</dt>
        <dd>借助自定义组件&lt;router-link&gt;来创建链接|路由；相当于&lt;a&gt;；使用属性to代替了属性href</dd>
        <dd>借助自定义组件&lt;router-view&gt;显示与 URL 对应的组件|路由出口</dd>
        <dd>有&lt;router-link&gt;路由，则必须有&lt;router-view&gt;路由出口</dd>
        <dd>可以有多个&lt;router-view&gt;，使用name属性区分；相应的路由配置也要变化，见后例</dd>
        <dd>还可以像缓存组件那样，缓存&lt;router-view&gt;，见后例</dd>
        <dd>使用内置active-class属性高亮当前路由项</dd>
        <dd>
            <figure class="code">
                <figcaption>在入口组件中使用路由</figcaption>
                <pre>
//&lt;router-link&gt; - 字符串方法；也可以使用对象方法 :to = "{path: '/about'}"
//为所有&lt;router-link&gt;指定active-class类即可高亮当前活动项
&lt;router-link to = "/home" active-class = "active"&gt;home&lt;/router-link&gt;
&lt;router-link to = "/info" active-class = "active"&gt;info&lt;/router-link&gt;
&lt;router-link to = "/team" active-class = "active"&gt;team&lt;/router-link&gt;
&lt;router-link replace to = "/about" active-class = "active"&gt;about&lt;/router-link&gt;

//使用命名路由 - 向 router-link 组件的 to 属性传递一个对象：属性绑定
&lt;router-link :to = "{name: 'zhuye'}" active-class = "active"&gt;home&lt;/router-link&gt;

//使用嵌套路由 - 第一个默认显示路由和和父级路由保持一致，如html5
&lt;router-link to = "/work" active-class = "active"&gt;html5&lt;/router-link&gt;
&lt;router-link to = "/work/css3" active-class = "active"&gt;css3&lt;/router-link&gt;
&lt;router-link to = "/work/js" active-class = "active"&gt;js&lt;/router-link&gt;

//&lt;router-view&gt;
&lt;router-view&gt;&lt;/router-view&gt;</pre>
            </figure>
        </dd>
        <dd class="example-sn">多&lt;router-view&gt;的使用</dd>
        <dd>路由配置由component该为components</dd>
        <dd class="code">
            <pre>
components:{
    //Cont.vue在cont渲染在cont视图
    cont: () => import('../views/Cont.vue')
}             </pre>
        </dd>
        <dd class="code">
            <pre>
components:{
    //Ad.vue在cont渲染在ad视图
    ad: () => import('../views/Ad.vue')
}             </pre>
        </dd>
        <dd>cont为内容视图；ad为广告视图</dd>
        <dd class="code">
            <pre>
&lt;router-view name="cont"&gt;&lt;/router-view&gt;
&lt;router-view name="ad"&gt;&lt;/router-view&gt;</pre>
        </dd>
        <dd class="example-sn">路由缓存</dd>
        <dd>不是简单的使用缓存组件包裹，而应该使用动态组件实现</dd>
        <dd class="code">
            <pre>
&lt;RouterView v-slot="{ Component }"&gt;
    &lt;transition&gt;
        &lt;keep-alive&gt;
        &lt;component :is="Component" /&gt;
        &lt;/keep-alive&gt;
    &lt;/transition&gt;
&lt;/RouterView&gt;</pre>
        </dd>
        <dt>路由器模式 - history</dt>
        <dd>1. history模式</dd>
        <dd>路由配置项</dd>
        <dd>URL不带#，为传统网站URL</dd>
        <dd>需要服务器端配合处理路径，否则容易出现404；后端运维基本技能</dd>
        <dd class="code">
            <pre>history: createWebHistory()</pre>
        </dd>
        <dd>2. hash模式</dd>
        <dd>路由配置项</dd>
        <dd>URL带#，看起来不够美观</dd>
        <dd>SEO优化性能略微不足</dd>
        <dd>兼容性更好，不需要服务器端配合处理路径；前后端开发比较省心</dd>
        <dd class="code">
            <pre>history: createWebHashHistory()</pre>
        </dd>
        <dd class="tips">
            <div>使用生命周期函数检查各路由组件的挂载和卸载情况</div>
            <div>默认是push模式，浏览器可以回退；使用replace属性可以防止浏览器回退</div>
        </dd>
    </dl>
    <div class="chap">带参路由</div>
    <dl class="nav-cont">
        <dt>动态路由 - params</dt>
        <dd>在URL后面采用<span class="warn">路径</span>的方式来传递参数，将给定匹配模式的路由映射到<span class="warn">同一个</span>组件，如/goods/1 和
            /goods/2 这样的 URL 都会映射到同一个路由：在同一个页面根据id显示不同的商品 </dd>
        <dd>使用一个或多个动态字段来实现；?表示该参数可选</dd>
        <dd>1. 配置路由参数 - 在work的2级路由css和js中，根据id展示对应的内容</dd>
        <dd class="code">
            <pre>
{
    path: '/work',
    name: 'work',
    component: () => import('../components/sub_view/Work.vue'),
    children: [
        {
        path: '',
        name: 'html',
        component: () => import('../components/sub_view/Html5.vue'),
        },
        {
        path: 'css/:id',
        name: 'css',
        component: () => import('../components/sub_view/Css3.vue'),
        },
        {
        path: 'js/:id',
        name: 'js',
        component: () => import('../components/sub_view/JavaScript.vue'),
        }
    ]
}</pre>
        </dd>
        <dd>2. 传递路由参数 - 可以使用普通路由path和命名路由name传递2级路由参数</dd>
        <dd class="code">
            <pre>
&lt;router-link to="/work/css/webcss3"&gt;css&lt;/router-link&gt;
&lt;router-link :to="{ name: 'js', params: { id: 'webjs' } }"&gt;js&lt;/router-link&gt;</pre>
        </dd>
        <dd>3. 接收路由参数</dd>
        <dd>在路由目标组件 - 结构 - 中使用全局变量$route接收路由参数</dd>
        <dd class="code">
            <pre>&lt;div&gt;{{ $route.params.id }}&lt;/div&gt;</pre>
        </dd>
        <dd>在路由目标组件 - 逻辑 - 中使用useRoute接收路由参数</dd>
        <dd class="code">
            <pre>
import { useRoute } from 'vue-router'
let route = useRoute()
console.log(route.params.id);</pre>
        </dd>
        <dd>另：多个路由参数的使用</dd>
        <dd class="code">
            <pre>
{
    name: "zhuye",
    path: '/home/:id/:title/:cont/:other?',
    component: Home
}</pre>
        </dd>
        <dd class="code">
            <pre>
&lt;router-link to = "{
    name: 'zhuye',
    params: {
        id: val0,
        title: val1,
        cont: val2
    }
    }" 
    active-class = "active"
&gt;
    home
&lt;/router-link&gt;</pre>
        </dd>
        <dt>查询路由 - query</dt>
        <dd>在URL后面使用?连接值对形式的查询字符串来传递参数</dd>
        <dd>基本使用同动态路由</dd>
        <dd class="code">
            <pre>http://127.0.0.1:5500/vue/router.html?name=gl&age=18</pre>
        </dd>
        <dd>1. 配置路由参数</dd>
        <dd>不需要特别配置</dd>
        <dd>2. 传递路由参数</dd>
        <dd>分别使用普通路由path和命名路由name传递路由参数</dd>
        <dd class="code">
            <pre>
&lt;router-link :to="{ path: 'team', query: { id: 100 } }"&gt;team&lt;/router-link&gt;
&lt;router-link :to="{ name: 'info', query: { id: 200 } }"&gt;info&lt;/router-link&gt;</pre>
        </dd>
        <dd>3. 接收路由参数</dd>
        <dd>在路由目标组件 - 结构 - 中使用$route.query接收路由参数</dd>
        <dd class="code">
            <pre>&lt;div&gt;{{ $route.query.id }}&lt;/div&gt;</pre>
        </dd>
        <dd>在路由目标组件 - 逻辑 - 中使用useRoute接收路由参数</dd>
        <dd>多个路由参数可以使用解构路由以简化语法</dd>
        <dd class="code">
            <pre>
import { useRoute } from 'vue-router'
let route = useRoute()
console.log(route.query.id);</pre>
        </dd>
        <dd>为避免失去响应式，应该使用toRefs</dd>
        <dd>
            <figure class="code">
                <figcaption>&lt;script&gt;接收路由参数</figcaption>
                <pre>
import {toRefs} from 'vue'
import {useRoute} from 'vue-router'
let route = useRoute()
let {query} = toRefs(route)</pre>
            </figure>
            <figure class="code">
                <figcaption>&lt;template&gt;渲染路由参数 - 解构路由</figcaption>
                <pre>
&lt;ul&gt;
    &lt;li&gt;{{query.id}}&lt;/li&gt;
    &lt;li&gt;{{query.title}}&lt;/li&gt;
    &lt;li&gt;{{query.cont}}&lt;/li&gt;
&lt;/ul&gt;</pre>
            </figure>
            <figure class="code">
                <figcaption>&lt;template&gt;渲染路由参数 - 不解构路由</figcaption>
                <pre>
&lt;ul&gt;
    &lt;li&gt;{{route.query.id}}&lt;/li&gt;
    &lt;li&gt;{{route.query.title}}&lt;/li&gt;
    &lt;li&gt;{{route.query.cont}}&lt;/li&gt;
&lt;/ul&gt;</pre>
            </figure>
        </dd>
        <dt>路由组件传参 - props</dt>
        <dd>按照组件传参的形式传递路由参数</dd>
        <dd>使用更方便</dd>
        <dd>默认是针对动态路由|params类型的路由参数</dd>
        <dd>查询路由|query需要特别处理</dd>
        <dd class="example-sn">动态路由|params</dd>
        <dd>1. 配置路由参数 - 指定props属性为true，传递的路由参数将被当作属性传递给组件</dd>
        <dd class="code">
            <pre>
{
    path: '/home/:id/:title/:cont/:other?',
    name: "zhuye",
    component: Home,
    props: true
}</pre>
        </dd>
        <dd>2. 接收路由参数 - &lt;script&gt;中定义属性来接收路由参数</dd>
        <dd class="code">
            <pre>
defineProps(['id', 'title', 'cont'])</pre>
        </dd>
        <dd>3. &lt;template&gt;渲染路由参数 - 直接使用</dd>
        <dd class="code">
            <pre>
&lt;ul&gt;
    &lt;li&gt;{{id}}&lt;/li&gt;
    &lt;li&gt;{{title}}&lt;/li&gt;
    &lt;li&gt;{{cont}}&lt;/li&gt;
&lt;/ul&gt;</pre>
        </dd>
        <dd class="example-sn">查询路由|query</dd>
        <dd>1. 定制props属性 - 将路由参数的query作为返回值传递出去 - route是形参</dd>
        <dd class="code">
            <pre>
{
    name: "zhuye",
    path: '/home/:id/:title/:cont/:other?',
    component: Home,
    props:(route)=>{
        console.log(route) //包含路由的各种信息：name、params、path、query
        return route.query
    }
}</pre>
        </dd>
        <dd>2. 脚本中接收路由参数 - 定义属性</dd>
        <dd class="code">
            <pre>
defineProps(['id', 'title', 'cont'])</pre>
        </dd>
    </dl>
    <div class="chap">编程路由 - router</div>
    <dl class="nav-cont">
        <dd>除了使用 &lt;router-link&gt; 创建 &lt;a&gt; 标签来定义声明式路由外，还可以借助 router 的实例方法，编写代码来实现编程式路由</dd>
        <dd>需引入路由包 useRouter并创建路由实例router</dd>
        <dd class="code">
            <pre>
import { useRouter } from 'vue-router'
const router = useRouter()</pre>
        </dd>
        <dd>想要导航到不同的 URL，可以使用 router.push 方法</dd>
        <dd>点击 &lt;router-link&gt; 时，相当于调用 router.push(...) </dd>
        <dd class="example-sn">3秒后跳转至首页</dd>
        <dd>
            <figure class="code">
                <figcaption>在生命周期函数中实现路由导航</figcaption>
                <pre>
//引入
import {onMounted} from 'vue'
import {useRouter} from 'vue-router'

//使用 
const router = useRouter()
onMounted(()=>{
    setTimeout(()=>{
        //router.push('/home')
        router.replace('/home')//这里通常使用replace模式
    }, 3000)
})</pre>
            </figure>
        </dd>
        <dd class="tips">
            <div>使用更为直观的倒计时实现</div>
        </dd>
    </dl>
    <div class="chap">小结</div>
    <dl>
        <dd>在结构中使用路由参数时，使用全局变量$route解构：动态路由$route.params；查询路由$route.query</dd>
    </dl>
    <iframe src="../common/footer.html" frameborder="0" scrolling="no" title="footer" id="footer"></iframe>
</body>

</html>