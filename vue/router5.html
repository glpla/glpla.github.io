<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>导航守卫 Navigation Guards</title>
    <link rel="stylesheet" href="../css/common.css">
    <base target="_blank">
</head>

<body>
    <header>
        <h1>导航守卫</h1>
        <span>&commat; Navigation Guards</span>
    </header>
    <dl>
        <dt>导航解析流程</dt>
        <dd class="sn">
            <div>导航被触发</div>
            <div>在失活的组件里调用 beforeRouteLeave 守卫</div>
            <div>调用全局的 beforeEach 守卫</div>
            <div>在重用的组件里调用 beforeRouteUpdate 守卫(2.2+)</div>
            <div>在路由配置里调用 beforeEnter</div>
            <div>解析异步路由组件</div>
            <div>在被激活的组件里调用 beforeRouteEnter</div>
            <div>调用全局的 beforeResolve 守卫(2.5+)</div>
            <div>导航被确认</div>
            <div>调用全局的 afterEach 钩子</div>
            <div>触发 DOM 更新</div>
            <div>调用 beforeRouteEnter 守卫中传给 next 的回调函数，创建好的组件实例会作为回调函数的参数传入</div>
        </dd>
        <dt>全局前置守卫 beforeEach </dt>
        <dd>使用 router.beforeEach 注册一个全局前置守卫</dd>
        <dd>接收3个参数：</dd>
        <dd>1. from：离开的路由</dd>
        <dd>2. to：进入的路由</dd>
        <dd>3. next：路由拦截，如：未登录不允许访问，并引导|重定向到指定页面</dd>
        <dd>正常访问</dd>
        <dd>
            <pre>
router.beforeEach((to, from, next) => {
    console.log('router from', from.path, 'to ', to.path);
    next()
})</pre>
        </dd>
        <dd>不允许访问</dd>
        <dd>
            <pre>
router.beforeEach((to, from, next) => {
    console.log('router from', from.path, 'to ', to.path);
    if(to.path=='/home')
        next(false)
})</pre>
        </dd>
        <dt>全局解析守卫 beforeResolve</dt>
        <dd>使用 router.beforeResolve 注册一个全局守卫</dd>
        <dt>全局后置钩子 afterEach</dt>
        <dd>不会接受 next 函数也不会改变导航本身</dd>
        <dd>接收2个参数：from、to</dd>
        <dd>
            <pre>
router.afterEach((to, from) => {
    //sendToAnalytics(to.fullPath)
})</pre>
        </dd>
        <dt>路由独享的守卫</dt>
        <dd>局部路由</dd>
        <dd class="example-sn">折叠导航菜单 - 导航变化时；单击当前导航</dd>
        <dd>在路由文件中，引入仓库</dd>
        <dd>每次进入，创建菜单实例并设置菜单栏样式为隐藏；也可以创建该仓库的全局仓库</dd>
        <dd>导航守卫运行在 Vue 应用初始化的早期阶段，此时可能还未创建或注入 Pinia store 实例</dd>
        <dd>
            <pre>
import { useMenuStore } from '@/stores/menu'

router.beforeEach((to, from, next) => {
    const store = useMenuStore();
    store.flag = false;
    NProgress.start();
    next();
})

router.afterEach((to, from) => {
    if (to.path === from.path) {
        const store = useMenuStore()
        store.flag = false
    }
})</pre>
        </dd>
        <dd class="example-sn">设置页面标题 title - 导航结束后</dd>
        <dd>
            <pre>
router.afterEach((to, from) => {
    document.title = to.meta.title
})</pre>
        </dd>
        <dd class="example-sn">添加页面 <a href="../node/dependency.html">NProgress - 进度条</a> 特效 - 导航前开始，导航后结束</dd>
        <dd>
            <pre>
router.beforeEach((to, from, next) => {
    NProgress.start();
    next()
})
    
router.afterEach((to, from) => {
    NProgress.done();
})
            </pre>
        </dd>
        <dd class="tips">
            <div>更多路由控制，应该由后端服务器实现，前端不可靠</div>
            <div>前提是路由配置时，为每个路由指定meta属性</div>
            <div>如果不是每个路由都指定，应先判断再使用</div>
        </dd>
    </dl>
    <iframe src="../common/footer.html" frameborder="0" scrolling="no" title="footer" id="footer"></iframe>
</body>

</html>