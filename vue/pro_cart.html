<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>综合开发之购物车</title>
  <link rel="stylesheet" href="./css/mix.css">
</head>

<body>
  <header>
    <h1 class="title">购物车 <br>Cart</h1>
    <div class="theme" id="theme">
      <span class="iconfont icon-Sun"></span>
      <span class="iconfont icon-Moon-Star"></span>
    </div>
    <span class="iconfont icon-menu ham" id="ham"></span>
    <div class="nav-wrap">
      <div class="logo"></div>
      <nav class="nav">
        <a class="nav-item" style="--s:--n0" href="#objective"><span class="iconfont icon-mylocation"></span>
          Objective</a>
        <a class="nav-item" style="--s:--n1" href="#content"><span class="iconfont icon-assignment"></span> Content</a>
        <a class="nav-item" style="--s:--n2" href="#review"><span class="iconfont icon-group"></span> Review</a>
        <a class="nav-item" style="--s:--n3" href="#introduction"><span class="iconfont icon-magicwand"></span>
          Introduction</a>
        <a class="nav-item" style="--s:--n4" href="#procedure"><span class="iconfont icon-codepen1"></span>
          Procedure</a>
        <a class="nav-item" style="--s:--n5" href="#prerequisite"><span class="iconfont icon-assistantphoto"></span>
          Prerequisite</a>
        <a class="nav-item" style="--s:--n6" href="#cartjs"><span class="iconfont icon-shoppingcart"></span>
          cart.js</a>
        <a class="nav-item" style="--s:--n7" href="#details"><span class="iconfont icon-details"></span>
          DetailsView.vue</a>
        <a class="nav-item" style="--s:--n8" href="#menu"><span class="iconfont icon-menu1"></span>
          MenuView.vue</a>
        <a class="nav-item" style="--s:--n9" href="#summary"><span class="iconfont icon-hangzhengguanli"></span>
          Summary</a>
        <a class="nav-item" style="--s:--n10" href="#homework"><span class="iconfont icon-appguanli"></span>
          Homework</a>
        <a class="nav-item" style="--s:--n11" href="#reference"><span class="iconfont icon-clip"></span> Reference</a>
      </nav>
    </div>
  </header>
  <section class="section" style="--s:--n0" id="objective">
    <h2>目标 Objective</h2>
  </section>
  <section class="section" style="--s:--n1" id="content">
    <h2>内容 Content</h2>
  </section>
  <section class="section" style="--s:--n2" id="review">
    <h2>回顾 Review</h2>
  </section>
  <section class="section" style="--s:--n3" id="introduction">
    <h2>引言 Introduction</h2>
  </section>
  <section class="section" style="--s:--n4" id="procedure">
    <h2>过程 Procedure</h2>
  </section>
  <section class="section" style="--s:--n5" id="prerequisite">
    <h2>前置 Prerequisite</h2>
  </section>
  <section class="section" style="--s:--n6" id="cartjs">
    <h2>购物车仓库 cart.js</h2>
    <p>. 详情请查看 <a class="link" target="_blank" href="./pinia_case.html#cart">购物车</a></p>
  </section>
  <section class="section" style="--s:--n7" id="details">
    <h2>详情页 DetailsView.vue</h2>
    <div>内容：加载商品数据并清洗 → 渲染 → 生成购物车数据</div>
    <ol>
      <li>购物车静态效果</li>
      <p>. 购物车固定定位在详情页底部；没有封装</p>
      <p>. 基本结构，无数据绑定、无事件</p>
      <p>. 高度同主导航；网格布局；平分空间；保持间隔；其它价格部分单独设置结束对齐</p>
      <p>. 按钮的初始化和相关变量均来自主样式文件 app.css</p>
      <pre>
&lt;div class="cart"&gt;
  &lt;span class="price"&gt;&yen;&lt;span&gt;99&lt;/span&gt;起&lt;/span&gt;
  &lt;div class="opers"&gt;
    &lt;button class="oper dec"&gt;-&lt;/button&gt;
    &lt;div class="quantity"&gt;1&lt;/div&gt;
    &lt;button class="oper inc"&gt;+&lt;/button&gt;
  &lt;/div&gt;
  &lt;button class="btn btn-cart"&gt;加入购物车&lt;/button&gt;
  &lt;button class="btn btn-buy"&gt;立即购买&lt;/button&gt;
&lt;/div&gt;</pre>
      <figure>
        <img src="./imgs/carts0.png" alt="">
        <figcaption>购物车静态效果</figcaption>
      </figure>
      <li>准备数据及清洗</li>
      <p>. 在 onMounted 中已经获取到了商品数据；需要准备添加到购物车的数据；除了保持基本信息外，要增加一个数量字段 quantity，默认是1</p>
      <p>. 利用解构处理数据；这里没有处理规格 specification、甜点 dessert 和推荐商品 recommend</p>
      <pre>const good = ref({})</pre>
      <pre>
onMounted(async () => {
  let res = await goodsStore.getById(route.params.id)
  good.value = { 
    ...res, 
    quantity: 1,
    dessert: [],  
    recommend: [] 
  }
})</pre>
      <p>. 准备数据及清洗进阶版 - 处理规格 specification</p>
      <pre>
onMounted(async () => {
  let res = await goodsStore.getById(route.params.id)
  good.value = {
    ...res,
    quantity: 1,
    cup: res.specification[0].options.find(item => item.sel == true).label,
    ther: res.specification[1].options.find(item => item.sel == true).label,
    sugar: res.specification[2].options.find(item => item.sel == true).label,
    dessert: [],  
    recommend: [] 
  }
})</pre>
      <li>增加/减少数量</li>
      <p>. 为数量按钮绑定单击事件</p>
      <p>. 利用按钮的 disabled 处理越界；只判断下边界</p>
      <p>. 这里使用内联事件实现</p>
      <pre>
&lt;div class="opers"&gt;
  &lt;button class="oper dec" @click="good.quantity--" :disabled="good.quantity &lt;= 1"&gt;-&lt;/button&gt;
  &lt;div class="quantity"&gt;{{ good.quantity }}&lt;/div&gt;
  &lt;button class="oper inc" @click="good.quantity++"&gt;+&lt;/button&gt;
&lt;/div&gt;</pre>
      <li>处理总价</li>
      <p>. 利用计算 computed() 或监听 watch()</p>
      <pre>
const total = computed(() => {
  return (good.value.price * (1 - good.value.discount) * good.value.quantity).toFixed(2)
})</pre>
      <li>添加到购物车</li>
      <p>. 为加入购物车指定事件 addToCarts</p>
      <p>. 创建购物车数据项：增加新字段 productId，保存商品 id；商品原 id 字段可以保留，也可以移除</p>
      <p>. 数据项的 id 可以在这里指定；也可以在购物车仓库中指定；这里由购物车仓库指定</p>
      <p>. 跳转到菜单视图；这里使用替换 replace 模式</p>
      <pre>
const addToCarts = () => {
  const cartItem = {
    ...good.value,
    productId: good.value.id,
  };
  cartStore.addToCarts(cartItem)
  router.replace('/menu')
}</pre>
      <li>立即购买</li>
      <p>. 略</p>
      <li>更新视图</li>
      <p>. 使用响应式数据替换掉上述静态结构中的数据</p>
      <p>. 更多效果自行完成</p>
    </ol>
  </section>
  <section class="section" style="--s:--n8" id="menu">
    <h2>菜单页 MenuView.vue</h2>
  </section>
  <section class="section" style="--s:--n9" id="summary">
    <h2>小结 Summary</h2>
    <ol></ol>
  </section>
  <section class="section" style="--s:--n10" id="homework">
    <h2>作业 Homework</h2>
    <ol></ol>
  </section>
  <section class="section" style="--s:--n11" id="reference">
    <h2>参考 Reference</h2>
    <ol class="reference"></ol>
  </section>
  <div id="footer"></div>
  <script src="/utils/custom/footer.js"></script>
  <script src="/utils/custom/mix.js"></script>
</body>

</html>