<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>位置 Location</title>
    <link rel="stylesheet" href="../css/common.css">
    <base target="_blank">
</head>

<body>
    <header>
        <h1>位置</h1>
        <span>&commat;Location</span>
        <span class="iconfont icon-menu ham"></span>
        <nav class="nav">
            <a href="" style="--delay:3" class="nav-item">&lt;map&gt;</a>
            <a href="" style="--delay:2" class="nav-item">getLocation</a>
            <a href="" style="--delay:1" class="nav-item">openLocation</a>
            <a href="" style="--delay:0" class="nav-item">chooseLocation</a>
            <a href="" style="--delay:1" class="nav-item">choosePoi</a>
            <a href="" style="--delay:2" class="nav-item">chooseAddress</a>
            <a href="" style="--delay:3" class="nav-item">createMapContext</a>
        </nav>
    </header>
    <dl>
        <dd class="tips">调试的时候，应结合预览和真机调试共同使用</dd>
        <dt class="nav-cont">&lt;map&gt;</dt>
        <dd>渲染地图</dd>
        <dd>更多信息，请访问 <a href="https://developers.weixin.qq.com/miniprogram/dev/component/map.html">官方文档 - map</a></dd>
        <dd>
            <table>
                <caption>常用属性</caption>
                <tr>
                    <th>属性</th>
                    <th>说明</th>
                </tr>
                <tr>
                    <td>longitude</td>
                    <td>经度；<span class="warn">必填</span></td>
                </tr>
                <tr>
                    <td>latitude</td>
                    <td>纬度；<span class="warn">必填</span></td>
                </tr>
                <tr>
                    <td>show-location</td>
                    <td>显示带有方向的当前定位点</td>
                </tr>
                <tr>
                    <td>show-scale</td>
                    <td>显示缩放标尺</td>
                </tr>
                <tr>
                    <td>show-compass</td>
                    <td>显示罗盘</td>
                </tr>
                <tr>
                    <td>markers</td>
                    <td>
                        <div>在地图上显示标记的位置；结合地图服务API - 地点搜索实现</div>
                        <div>latitude：标记经度； <span class="warn">必填</span></div>
                        <div>longitude：标记维度； <span class="warn">必填</span></div>
                        <div>iconPath：标记图片路径； <span class="warn">必填</span></div>
                        <div>id：标记id；number；注意是数字类型；每个标记的id应该不同； <span class="warn">必填</span></div>
                        <div>width：标记宽度；实际开发 <span class="warn">必填</span></div>
                        <div>height：标记高度；实际开发 <span class="warn">必填</span></div>
                        <div>label：标签；在标记下方显示信息；对象类型</div>
                        <div>callout：单击标记，在上方显示content信息，单击地图其它地方，信息消失；对象类型</div>
                    </td>
                </tr>
                <tr>
                    <td>bindtap</td>
                    <td>单击地图，获取单击点经纬度信息</td>
                </tr>
                <tr>
                    <td>bindmarkertap</td>
                    <td>单击地图标记，获取标记点id</td>
                </tr>
                <tr>
                    <td>bindcallouttap</td>
                    <td>单击标记的气泡触发</td>
                </tr>
                <tr>
                    <td>bindlabeltap</td>
                    <td>单击标记的标签触发</td>
                </tr>
            </table>
        </dd>
        <dd class="tips">[渲染层错误] [Component] &lt;map&gt;:width and heigth of marker id 1 are required</dd>
        <dd>
            <table>
                <caption>气泡callout vs 标签label</caption>
                <tr>
                    <th>属性</th>
                    <th>callout</th>
                    <th>label</th>
                </tr>
                <tr>
                    <td>display</td>
                    <td>√：BYCLICK、ALWAYS、NEVER</td>
                    <td>×</td>
                </tr>
                <tr>
                    <td>content</td>
                    <td>√</td>
                    <td>√</td>
                </tr>
                <tr>
                    <td>color</td>
                    <td>√</td>
                    <td>√</td>
                </tr>
                <tr>
                    <td>fontSize</td>
                    <td>√</td>
                    <td>√</td>
                </tr>
                <tr>
                    <td>anchorX</td>
                    <td>√：marker 对应的经纬度</td>
                    <td>√</td>
                </tr>
                <tr>
                    <td>anchorY</td>
                    <td>√：marker 对应的经纬度</td>
                    <td>√</td>
                </tr>
                <tr>
                    <td>borderWidth</td>
                    <td>√</td>
                    <td>√</td>
                </tr>
                <tr>
                    <td>borderColor</td>
                    <td>√</td>
                    <td>√</td>
                </tr>
                <tr>
                    <td>borderRadius</td>
                    <td>√</td>
                    <td>√</td>
                </tr>
                <tr>
                    <td>bgColor</td>
                    <td>√</td>
                    <td>√</td>
                </tr>
                <tr>
                    <td>padding</td>
                    <td>√</td>
                    <td>√</td>
                </tr>
                <tr>
                    <td>textAlign</td>
                    <td>√：left, right, center</td>
                    <td>√</td>
                </tr>
            </table>
        </dd>
        <dt class="nav-cont">wx.getLocation(Object object)</dt>
        <dd>
            <p>分类：位置接口</p>
            <p>获取当前的地理位置、速度</p>
            <p>需要在 app.json 中进行声明；详情请查看 <a
                    href="https://developers.weixin.qq.com/community/develop/doc/000a02f2c5026891650e7f40351c01">具体规则公告</a>
                、<a href="https://developers.weixin.qq.com/miniprogram/dev/api/location/wx.getLocation.html">官方文档 -
                    getLocation</a></p>
            <p>默认 type 是 GPS，推荐使用 gcj02</p>
            <p>只针对部分限定类目的小程序开放</p>
            <p>需要开通权限：[开发] → [开发管理] → [接口设置]中自助开通</p>
            <p>提示：增加调用频率限制</p>
            <pre>
wx.getLocation({
    type: 'gcj02',
    success: res => {
        console.log('getLocation ok', res);
    },
    fail: err => console.log('getLocation fail', err)
})</pre>
        </dd>
        <dt class="nav-cont">wx.openLocation(Object object)</dt>
        <dd>
            <p>分类：位置接口</p>
            <p>使用微信内置地图查看位置，并将指定的地点居中显示；通常用于在用户需要查看某个特定位置的详细地图和周边情况</p>
            <p>如果不提供 latitude 和 longitude，地图将以用户当前位置为中心</p>
            <p>wx.openLocation() 通常与 wx.getLocation() 或 wx.chooseLocation() 结合使用，先获取位置信息，然后使用这些信息打开地图</p>
            <p>更多信息，请访问 <a
                    href="https://developers.weixin.qq.com/miniprogram/dev/api/location/wx.openLocation.html">官方文档 -
                    openLocation</a></p>
        </dd>
        <dt class="nav-cont">wx.chooseLocation(Object object)</dt>
        <dd>
            <p>分类：位置接口</p>
            <p>打开地图选择位置</p>
            <p>更多信息，请访问 <a
                    href="https://developers.weixin.qq.com/miniprogram/dev/api/location/wx.chooseLocation.html">官方文档
                    - chooseLocation</a></p>
            <pre>
chooseLoc() {
    wx.chooseLocation({
        success: res => {
        console.log('chooseLocation ok', res);
        },
        fail: err => console.log('chooseLocation fail', err)
    })
}</pre>
        </dd>
        <dt class="nav-cont">wx.choosePoi(Object object)</dt>
        <dd>
            <p>分类：位置接口</p>
            <p>打开POI列表选择位置</p>
            <p>更多信息，请访问 <a href="https://developers.weixin.qq.com/miniprogram/dev/api/location/wx.choosePoi.html">官方文档 -
                    choosePoi</a>
            </p>
            <pre>
choosePoi() {
    wx.choosePoi({
        success: res => {
        console.log('choose poi ok', res);
        },
        fail: err => console.log('choose poi fail', err)
    })
}</pre>
            <p class="tips">choosePoi:fail 开发者工具暂时不支持此 API 调试，请使用真机进行开发</p>
        </dd>
        <dt class="nav-cont">wx.chooseAddress(Object object)</dt>
        <dd>
            <p>分类：开放接口</p>
            <p>获取用户收货地址。调起用户编辑收货地址原生界面，并在编辑完成后返回用户选择的地址</p>
            <p>更多信息，请访问 <a
                    href="https://developers.weixin.qq.com/miniprogram/dev/api/open-api/address/wx.chooseAddress.html">官方文档
                    - chooseAddress</a></p>
            <pre>
chooseAddr() {
    wx.chooseAddress({
        success: res => console.log('chooseAddress ok', res),
        fail: err => console.log('chooseAddress fail', err)
    })
}</pre>
        </dd>
        <dt class="nav-cont">wx.createMapContext(string mapId, Object this)</dt>
        <dd>深入控制地图：根据地图组件 map 的 mapId 创建其上下文 MapContext 对象，与地图交互</dd>
        <dd>MapContext 通过 <span class="warn">id</span> 跟一个 map 组件绑定，操作对应的 map 组件；常用方法有：</dd>
        <dd class="sn">
            <div>moveToLocation(Object object)</div>
            <p>将地图中心移置当前定位点；地图组件 <span class="warn">需</span> 设置 show-location 为true</p>
            <p>经纬度非必须</p>
            <div>addMarkers(Object object)</div>
            <p>在地图上添加标记</p>
            <div>getCenterLocation(Object object)</div>
            <p>获取当前地图中心的经纬度；返回 gcj02 坐标系，可以用于 wx.openLocation()</p>
        </dd>
        <dd>更多信息，请访问 <a href="https://developers.weixin.qq.com/miniprogram/dev/api/media/map/MapContext.html">官方文档 -
                MapContext</a></dd>
        <dd class="example-sn">map基本使用</dd>
        <dd class="sn">
            <div>配置app.json - 只需配置一次，全局生效</div>
            <p>根据需要的具体业务指定</p>
            <pre>
"requiredPrivateInfos":[
    "getLocation",
    "chooseLocation",
    "choosePoi",
    "chooseAddress"
]</pre>
            <p>非必须 - 具体视版本而定；系统通过弹窗提示是否授权</p>
            <pre>
"permission": {
    "scope.userLocation": {
        "desc": "你的位置信息将用于小程序位置接口的效果展示"
    }
}</pre>
            <div>页面.wxml - 使用位置信息渲染地图组件&lt;map&gt;；使用固定定位的图片元素返回地图中心</div>
            <pre>
&lt;map
    class="map" 
    id="map"
    longitude="{{longitude}}" 
    latitude="{{latitude}}" 
    show-location 
    show-scale 
    show-compass 
    bindtap='getMapInfo' 
    bindmarkertap="getMarker" 
    bindlabeltap="getLabel" 
    bindcallouttap="getCallout"
    bindregionchange="changeRegion"/&gt;
&lt;image class="img" src="../../utils/center.png" mode="aspectFill" bind:tap="moveToLocation" /&gt;</pre>
            <div>页面.wxss - 设置样式宽高同屏幕</div>
            <pre>
map{
    width: 100vw;
    height: 100vh;
}

.img {
    position: fixed;
    bottom: 20px;
    left: 20px;
    width: 30px;
    height: 30px;
}</pre>
            <div>在 Page 外部声明全局地图上下文变量 mapCtx，在页面 onLoad 中初始化</div>
            <pre>mapCtx = wx.createMapContext('map')</pre>
            <div>在 data 中声明经纬度变量、标记点，用作视图绑定</div>
            <pre>
data: {
    longitude: '',
    latitude: '',
    markers: []
}</pre>
            <div>在 onLoad 中同时获取位置信息</div>
            <pre>
wx.getLocation({
    type: 'gcj02',
    success: res => {
        console.log(res);
        this.setData({
            latitude: res.latitude,
            longitude: res.longitude
        })
    }
})</pre>
            <div>添加标记点函数，使用经纬度作为形参</div>
            <pre>
addCenterMarkers(lati, long) {
    let markers = this.data.markers
    let ind = markers.length
    let marker = {
        id: ind,
        latitude: lati,
        longitude: long,
        iconPath: '../../utils/marker.png',
        width: 32,
        height: 32,
        callout: {
            content: 'top',
            color: '#ff4400',
            textAlign: 'cneter',
            display: 'BYCLICK'
        },
        label: {
            content: 'center',
            color: '#ff4400',
            textAlign: 'cneter'
        }
    }
    markers.push(marker)
    this.setData({
        markers
    })
}</pre>
            <div>单击返回中心，使地图回到中心点</div>
            <pre>
moveToLocation() {
    mapCtx.moveToLocation({
        longitude: this.data.longitude,
        latitude: this.data.latitude
    })
}</pre>
            <div>移动地图 - 略</div>
            <pre>
changeRegion(e) {
console.log('moving', e);
}</pre>
            <div>其它事件 - 借助UI API；略</div>
            <pre>
getMapInfo(e) {
    console.log(e);
    wx.showToast({
        title: 'map tapped',
    })
    // 每次单击地图时，增加一个 markers
    this.addCenterMarkers(e.detail.latitude, e.detail.longitude)
},

getMarker(e) {
    console.log('marker tap', e);
    wx.showToast({
        title: 'marker tapped',
    })
},

getLabel(e) {
    console.log('label tap', e);
    wx.showToast({
        title: 'label tapped',
    })
},

getCallout(e) {
    console.log('callout tap', e);
    wx.showToast({
        title: 'callout tapped',
    })
}</pre>
            <figure>
                <img src="./imgs/map0.png" alt="">
                <figcaption>地图及中心点</figcaption>
            </figure>
            <figure>
                <img src="./imgs/map1.png" alt="">
                <figcaption>添加 marker</figcaption>
            </figure>
            <figure>
                <img src="./imgs/map2.png" alt="">
                <figcaption>单击 label</figcaption>
            </figure>
        </dd>
        <dd class="tips">开发工具的模拟器和预览、真机调试有差别</dd>
        <dt>第三方平台</dt>
        <dd><a href="https://lbs.qq.com/">腾讯位置服务 LBS</a></dd>
        <dd><a href="https://api.map.baidu.com/mapCard/">百度地图开放平台</a></dd>
    </dl>
    <iframe src="../common/footer.html" frameborder="0" scrolling="no" title="footer" id="footer"></iframe>
    <script src="/utils/custom/ham2024.js"></script>
    <script src="/utils/custom/star.js"></script>
</body>

</html>