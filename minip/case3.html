<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>美食荟 Foods</title>
    <link rel="stylesheet" href="../css/code.css">
    <link rel="stylesheet" href="../css/sn.css">
    <link rel="stylesheet" href="./css/case3.css">
    <base target="_blank">
</head>

<body>
    <div class="wrap">
        <header>
            <img src="./imgs/food0.png" alt="">
            <img src="./imgs/food1.png" alt="">
            <img src="./imgs/food2.png" alt="">
            <img src="./imgs/food3.png" alt="">
            <img src="./imgs/food4.png" alt="">
            <h1>Foods, Only Foods</h1>
        </header>
        <dl>
            <dt><span>General</span> 概要</dt>
            <dd class="number">
                <div>内容</div>
                <p>.美食列表</p>
                <div>目的</div>
                <p>.熟悉资源服务器的搭建</p>
                <p>.掌握网络请求的基本过程</p>
                <p>.掌握页面的生命周期函数的使用</p>
                <p>.掌握下拉刷新和触底加载的原理和实现</p>
                <div>原理</div>
                <p>.从资源服务器读取数据并渲染</p>
                <div>要求</div>
                <p>.按照以下步骤完成美食列表的设计和开发</p>
                <p>.独立完成</p>
            </dd>
        </dl>
        <dl>
            <dt><span>Project</span> 项目介绍</dt>
            <dd class="number">
                <div>首次加载并渲染10条数据</div>
                <div>拖动到底部后，触发加载更多数据</div>
                <div>顶部下拉时，触发数据刷新</div>
                <div>当所有数据加载完毕后，提示"所有数据加载完毕"</div>
                <div>单击某个美食，进入到详情页</div>
            </dd>
        </dl>
        <dl>
            <dt><span>Keypoints</span> 知识点</dt>
            <dd class="number">
                <div>搭建服务器 Node.js</div>
                <div>列表渲染 wx:for</div>
                <div>生命周期函数 lifetime</div>
                <div>网络请求 wx.request</div>
                <div>下拉刷新 pulldownRefresh</div>
                <div>触底加载 reachBottom</div>
                <div>导航及传参 navigator</div>
            </dd>
        </dl>
        <dl>
            <dt><span>Footage</span> 素材准备</dt>
            <dd class="number">
                <div>数据文件 JSON</div>
                <p>数据节点信息要素；准备若干条</p>
                <p>为调试方便，没有给出完整的图片路径，仅给出图片部分路径，后期再拼接上资源服务器的地址</p>
                <pre>
{
    "id": 1,
    "image": "/img/2846ed948e95eef4c4d50edaf52a483432023.jpg",
    "name": "宫廷月亮虾饼",
    "phone": "15530710686",
    "address": "任丘市裕华中路与会战道交叉口东南角蕾莎汇生活4层",
    "businessHours": "周一至周日10:00-21:00"
}</pre>
                <div>产品图片 images</div>
                <div>阿里字体图标 iconfont</div>
                <p>店铺、地址、联系电话、营业时间</p>
                <div>资源服务器</div>
                <p>node.js、express</p>
            </dd>
        </dl>
        <dl>
            <dt><span>Pages</span> 项目页面</dt>
            <dd class="number">
                <div>列表页 index</div>
                <div>详情页 detail - 自行完成</div>
            </dd>
        </dl>
        <dl>
            <dt><span>Step 1</span>: 项目创建</dt>
            <dd class="number">
                <div>创建空白文件夹 foods</div>
                <div>打开微信开发者工具</div>
                <div>新建项目；项目名称为 foods，项目目录为刚才创建的空白文件夹 foods</div>
                <div>其他根据实际情况填写</div>
                <div>最后确定，完成项目的创建</div>
            </dd>
        </dl>
        <dl>
            <dt><span>Step 2</span>: app.json项目设置</dt>
            <p>颜色、标题可以自定</p>
            <dd class="number">
                <div>标题栏设置</div>
                <pre class="code">
"window": {
    "navigationBarTextStyle": "white",
    "navigationBarTitleText": "foods",
    "navigationBarBackgroundColor": "#f39c12"
}</pre>
                <div>页面配置：index、detail</div>
                <pre class="code">
"pages": [
    "pages/index/index",
    "pages/detail/detail"
]</pre>
            </dd>
            <dt><span>Step 3</span>: app.wxss</dt>
            <dd class="number">
                <div>初始化样式</div>
                <p>盒模型</p>
                <div>公共样式设置</div>
                <p>字体</p>
                <p>图片</p>
                <p>布局</p>
                <div>第三方样式</div>
                <p>导入@import</p>
            </dd>
        </dl>
        <dl>
            <dt><span>Step 4</span>: index 页面</dt>
            <dd class="number">
                <div>index.json - 导航栏标题</div>
                <p>使用下拉刷新</p>
                <pre class="code">
"navigationBarTitleText": "Foods",
"navigationBarBackgroundColor": "#ffa502",
"enablePullDownRefresh": true</pre>
                <div>index.wxml</div>
                <p>列表渲染</p>
                <figure>
                    <img src="./imgs/food5.png" alt="">
                </figure>
                <div>index.js</div>
                <p>网络请求 - 使用一个flag区分下拉刷新和触底加载</p>
                <figure class="code">
                    <figcaption>封装网络请求函数</figcaption>
                    <pre>
loadLists(flag) {
    this.isLoading = true
    wx.showLoading({
        title: 'Loading'
    })
    wx.request({
        url: baseURL + '/food',
        method: 'GET',
        data: {
        page: this.data.page,
        pageSize: this.data.pageSize
        },
        success: (res) => {
        console.log(res.data);
        this.setData({
            lists: [...this.data.lists, ...res.data],
            total: res.header['X-Total-Count']
        })
        },
        complete: () => {
        wx.hideLoading()
        this.isLoading = false
        if (flag) {
            wx.stopPullDownRefresh()
        }
        }
    })
}</pre>
                </figure>
                <p>每个数据项绑定事件，单击后跳转到详情页</p>
                <pre class="code">
toDetail(e) {
    wx.navigateTo({
        url: './detail/detail?id=' + e.currentTarget.dataset.id,
    })
}</pre>
                <p>详情页在onLoad中获取id并渲染对应的商品</p>
                <pre class="code">
onLoad(options) {
    this.setData({
        id: options.id
    })
    //自行完成
}</pre>
                <p>下拉刷新 - 页数初始化；初始化完成后，停止刷新动画</p>
                <figure class="code">
                    <figcaption>下拉刷新</figcaption>
                    <pre>
onPullDownRefresh() {
    this.setData({
        page: 1,
        lists: []
    })
    this.loadLists(true)
}</pre>
                </figure>
                <p>触底加载 - 页数和页大小达到总数时，停止加载并给出提示；数据加载中停止再次触发加载</p>
                <figure class="code">
                    <figcaption>触底加载</figcaption>
                    <pre>
onReachBottom() {
    if (this.data.page * this.data.pageSize >= this.data.total) {
        return wx.showToast({
        title: '数据加载完毕'
        })
    }
    if (this.isLoading) {
        return;
    }
    this.setData({
        page: this.data.page + 1
    })
    this.loadLists()
}                </pre>
                </figure>
                <div>index.wxss</div>
                <p>数据项渲染 - flex布局；溢出打点；注意直接父级也要溢出隐藏</p>
                <img src="./imgs/text0.png" alt="">
                <p>已加载数据和总数据展示 - 固定定位在页面右下角</p>
            </dd>
        </dl>
        <dl>
            <dt><span>Step 5</span>: detail 页面</dt>
            <dd>根据导航参数显示指定美食的详情</dd>
            <dd>请自行设计开发</dd>
        </dl>
        <footer class="txt-center">
            <img src="../imgs/avatar.jpg" alt="">
            <span>Best Wishes &copy; glpla 2024</span>
        </footer>
    </div>
</body>

</html>