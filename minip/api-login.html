<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>登录 Login</title>
  <link rel="stylesheet" href="../css/common2025.css">
  <base target="_blank">
</head>

<body>
  <header>
    <h1>登录</h1>
    <span>&commat;Login</span>
  </header>
  <section>
    <h3>普通登录</h3>
    <ul>
      <li>使用用户名、密码或邮箱、验证码登录</li>
      <li>多使用表单实现</li>
    </ul>
    <h3>小程序授权登录</h3>
    <ul>
      <li>借助小程序的宿主环境，通过小程序的授权实现登录</li>
      <li>必须要用户主动授权才可以实现；基于用户对产品充分了解并预知可能的风险</li>
    </ul>
    <h3>早期接口</h3>
    <ul>
      <li>以下接口均被官方回收或调整，建议使用 <a
          href="https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/userProfile.html">头像昵称填写</a>
        完善用户信息，即新项目示例代码所示
      </li>
    </ul>
    <ol>
      <li><a
          href="https://developers.weixin.qq.com/miniprogram/dev/api/open-api/user-info/wx.getUserProfile.html">wx.getUserProfile</a>
      </li>
      <li><a
          href="https://developers.weixin.qq.com/miniprogram/dev/api/open-api/user-info/wx.getUserInfo.html">wx.getUserInfo</a>
      </li>
      <li><a href="https://developers.weixin.qq.com/miniprogram/dev/api/open-api/user-info/UserInfo.html">UserInfo</a>
      </li>
      <li><a href="https://developers.weixin.qq.com/miniprogram/dev/component/button.html">&lt;button&gt;</a> 的
        open-type
      </li>
      <li><a href="https://developers.weixin.qq.com/miniprogram/dev/component/open-data.html">&lt;open-data&gt;</a>
      </li>
    </ol>
    <div>[<span class="iconfont icon-keyboard"></span>] 获取用户头像仅仅使用临时链接，保存到本地或发送到服务器；详情请参考 <a
        href="./case5.html">头像上传和下载</a></div>
    <ul>
      <li>核心代码参考</li>
      <pre>
&lt;button open-type="chooseAvatar" bind:chooseavatar="chooseAvatar"&gt;
    &lt;image src="{{userInfo.avatar}}" mode="aspectFill" /&gt;
&lt;/button&gt;
&lt;text&gt;{{userInfo.nickName}}&lt;/text&gt;
&lt;input type="nickname" bindinput="iptName" /&gt;</pre>
      <pre>
const defaultAvatarUrl = 'https://glpla.github.io/imgs/qrcode_glpla.github.io.png'

Page({
    data: {
        userInfo:{
            avatar: defaultAvatarUrl,
            nickName:''
        }
    },
    chooseAvatar(e) {
        this.setData({
            'userInfo.avatar': e.detail.avatarUrl
        })
        },
    iptName(e){
        this.setData({
            'userInfo.nickName':e.detail.value
        })
    }
})</pre>
    </ul>
    <h3>Process</h3>
    <ol>
      <li>启动时检查：在 onLaunch 中自动检查登录状态</li>
      <li>状态标记：使用 globalData.isLogin 标记登录状态</li>
      <li>多层验证：
        <p>检查本地是否有 token</p>
        <p>验证 token 是否过期</p>
        <p>检查微信 session 是否有效</p>
      </li>
      <li>数据持久化：使用 wx.setStorageSync 保存登录信息</li>
      <li>页面使用：在页面中通过 getApp().globalData.isLogin 获取登录状态</li>
      <li>登录/登出：提供完整的登录和登出功能</li>
    </ol>
  </section>
  <div id="footer"></div>
  <script src="/utils/custom/footer.js"></script>
</body>

</html>