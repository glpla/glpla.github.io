<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>音乐播放器 Player</title>
    <link rel="stylesheet" href="../css/exp.css">
    <link rel="stylesheet" href="../css/code.css">
    <base target="_blank">
</head>

<body>
    <header>
    </header>
    <div class="container">
        <h1>音乐播放器</h1>
        <h4>Player</h4>
        <dl class="number-mul-sn">
            <dt>目的</dt>
            <dd>
                <div>了解异步函数执行的过程</div>
                <div>掌握背景音频API的使用和注意事项</div>
                <div>进一步熟悉网络请求的基本过程</div>
            </dd>
            <dt>内容</dt>
            <dd>
                <div>素材准备</div>
                <div>服务器准备；如无可以使用在线素材，如 <a href="../index.html">大树小站</a> 在线资源</div>
                <div>音频API使用</div>
            </dd>
            <dt>步骤</dt>
            <dd>第一阶段 初体会</dd>
            <dd>
                <div>创建项目或页面</div>
                <div>在逻辑js中，创建音乐播放器BackgroundAudioManager实例</div>
                <div>指定title和src</div>
            </dd>
            <dd>第二阶段 音乐播放器</dd>
            <dd>
                <table class="tbl-sn">
                    <caption>数据支持</caption>
                    <tr>
                        <th>变量</th>
                        <th>说明</th>
                    </tr>
                    <tr>
                        <td>baseUrl</td>
                        <td>服务器地址，便于切换数据源</td>
                    </tr>
                    <tr>
                        <td>lists</td>
                        <td>播放列表；节点信息参考如下述代码</td>
                    </tr>
                    <tr>
                        <td>indMusic</td>
                        <td>播放列表索引 </td>
                    </tr>
                    <tr>
                        <td>isPause</td>
                        <td>播放状态 </td>
                    </tr>
                    <tr>
                        <td>valueMusic</td>
                        <td>播放进度</td>
                    </tr>
                    <tr>
                        <td>durationMusic</td>
                        <td>播放时长</td>
                    </tr>
                </table>
            </dd>
            <dd>
                <pre>
    {
        "id": 5,
        "title": "微风细雨",
        "singer": "wang",
        "src": "/music/wang.mp3",
        "coverImgUrl": "/music/wangfei.png"
    }</pre>

                <div>主要过程</div>
                <p>. 创建项目或页面，修改基本配置信息</p>
                <p>. 导入音频素材列表</p>
                <pre>
wx.request({
    url: 'http://127.0.0.1:3000/utils/data/song_list.json',
    success: (res) => {
        console.log(res.data);
        this.setData({
            lists: res.data.cont
        })
    }
});</pre>
                <p>. 创建音乐播放器BackgroundAudioManager实例；可以在Page外面声明；也可以在生命周期函数函数中声明</p>
                <p>. 侦听音乐播放器BackgroundAudioManager实例；执行播放、暂停、结束、进度更新等API，调整页面相关数据</p>
                <pre>
BGM.onPlay(() => {
    console.log('play');
    this.setData({
        dur: util.minsec(BGM.duration),
        isPause: true
    })
})
BGM.onPause(() => {
    console.log('pause');
    this.setData({
        isPause: false
    })
})
BGM.onEnded(() => {
    console.log('ended');
    this.setData({
        isPause: false,
        dur:'00:00',
        cur:'00:00'
    })
})
BGM.onError(() => {
    console.log('error');
})

//后期使用wxs计算
BGM.onTimeUpdate(() => {
    console.log('time updating');
    this.setData({
        duration: BGM.duration,
        value: BGM.currentTime
        dur: util.minsec(BGM.duration),
        cur: util.minsec(BGM.currentTime),
    })
})</pre>
                <p>. 播放、暂停：播放、暂停通过背景音频API实现</p>
                <pre>
playBGM() {
    this.initSong()
},
pauseBGM() {
    BGM.pause()
}
stopBGM() {
    BGM.stop()
}</pre>
                <p>. 音频播放函数；为音频实例BGM指定title、src、singer等基本参数；如果自动播放，可以在获取列表后，立即执行</p>
                <pre>
initSong() {
    BGM.title = this.data.lists[this.data.ind].title
    BGM.singer = this.data.lists[this.data.ind].singer
    BGM.src = this.data.baseUrl + this.data.lists[this.data.ind].src
}</pre>
                <p>. 上一首、下一首：通过播放列表索引 indMusic 增加或减少实现；每次更新，自动播放initSong()</p>
                <pre>
prevSong() {
    let indMusic = this.data.indMusic
    if (indMusic > 0) {
        indMusic--
        this.setData({
        indMusic: indMusic
        })
        this.initSong()
    }
    console.log(indMusic);
},
nextSong() {
    let indMusic = this.data.indMusic
    if (indMusic &lt; this.data.lists.length - 1) {
        indMusic++
        this.setData({
        indMusic: indMusic
        })
        this.initSong()
    }
    console.log(indMusic);
}</pre>
                <p>. 进度调节：利用滑块组件 slider 实现；拖动后，相应的调整BGM的播放进度seek</p>
                <pre>
sliderChange(e) {
    this.setData({
        value: e.detail.value
    })
    BGM.seek(e.detail.value)
}</pre>
                <p>. 播放时长、总时长：获取音频实例的相关属性</p>
                <p>. 音量调节：略</p>
                <p>. 封面图片特效：略</p>
                <p>. 其它设计：略</p>
            </dd>
            <dt>参考效果</dt>
            <dd>除了必要的登录凭证信息外，其它可自由设计</dd>
            <dd class="grid">
                <img src="../minip/imgs/p5.png" alt="">
                <img src="../minip/imgs/p6.png" alt="">
                <img src="../minip/imgs/p7.png" alt="">
                <img src="../minip/imgs/p8.png" alt="">
                <img src="../minip/imgs/p9.png" alt="">
                <img src="../minip/imgs/p3.png" alt="">
                <img src="../minip/imgs/p4.png" alt="">
                <img src="../minip/imgs/p10.png" alt="">
                <img src="../minip/imgs/p11.png" alt="">
            </dd>
            <dd>更多效果</dd>
            <dd class="grid">
                <img src="../minip/imgs/p0.png" alt="">
                <img src="../minip/imgs/p1.png" alt="">
                <img src="../minip/imgs/p2.png" alt="">
            </dd>
            <dt>要求</dt>
            <dd>
                <div>按照以上步骤分别完成设计与开发</div>
                <div>规范开发；独立完成；突出个人设计特点和风格</div>
                <div>实验报告：采用学院统一下发的格式文件，以图片或代码形式展示并说明实施过程、各部分功能、具体内容和实现细节，并按照要求命名，最后导出为PDF，提交个人学习通作业</div>
                <div>未按要求在规定时间内提交视为无效，不得分</div>
                <div>相关格式规范，请参考 <a href="../course/paper.html">论文格式规范 Paper Prettier</a></div>
            </dd>
            <dt>拓展</dt>
            <dd>
                <div>自动播放：数据加载完毕后自动播放</div>
                <div>列表循环：当前播放结束后，自动播放下一首；如果已经在最后一首，则播放第一首</div>
                <div>播放列表展示</div>
                <div>UI优化</div>
            </dd>
        </dl>
        <iframe src="../common/footer.html" frameborder="0" scrolling="no" title="footer" id="footer"></iframe>
    </div>
</body>

</html>