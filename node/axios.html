<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>网络请求 Axios</title>
  <link rel="stylesheet" href="../css/reset2024.css">
  <link rel="stylesheet" href="../css/common2024.css">
  <link rel="stylesheet" href="../css/code.css">
  <link rel="stylesheet" href="../css/sn.css">
  <base target="_blank">
  <style>
    #dog {
      width: 100%;
      max-width: 300px;
      aspect-ratio: 16/9;
      margin: 0 auto;
    }
  </style>
</head>

<body>
  <header>
    <h1>Axios</h1>
    <span>网络请求</span>
  </header>
  <dl>
    <dd class="tips">以下测试用例基于json-server环境</dd>
    <dt>简介 overview</dt>
    <dd>异步请求；基于 promise 的 HTTP 库，可以用在浏览器和 node.js 中</dd>
    <dd>通用、主流的第三方库；用于获取本地和远程json数据</dd>
    <dd>默认是Promise用法；支持async/await用法</dd>
    <dd>更多信息，点击访问<a href="https://www.axios-http.cn/" class="link">axios中文网</a></dd>
    <dt>基本过程</dt>
    <dd>1. 安装 - 在项目目录安装</dd>
    <dd class="code">
      <pre>npm i axios --save</pre>
    </dd>
    <dd>2. 引入 - 在项目中引入，并根据需要指定默认参数，如baseURL、params、method、header、timeout；baseURL应和数据服务器的地址保持一致</dd>
    <dd class="code">
      <pre>
import axios from 'axios'
axios.defaults.baseURL = 'http://localhost:3000'</pre>
    </dd>
    <dd>3. 使用 - 在组件的逻辑中请求数据，并应用到组件的结构中；<span class="warn">资源服务器应提前开启，并严格按照接口使用</span></dd>
    <dd class="code">
      <pre>
</pre>
    </dd>
    <dd>2. CDN方式 - 适合浏览器环境；建议将库下载到本地使用。。。CDN网络经常。。。</dd>
    <dd><a href="https://cdnjs.com/" class="link">cdnjs</a></dd>
    <dd><a href="https://www.bootcdn.cn/" class="link">bootcdn</a></dd>
    <dd class="code">
      <pre>
&lt;script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"&gt;&lt;/script&gt;</pre>
    </dd>
    <dt>请求方式</dt>
    <dd>分：promise和async/await两种风格</dd>
    <dd>
      <figure class="code">
        <figcaption>Promise - get</figcaption>
        <pre>
axios.get('/user?ID=12345')
  .then((response) => {
    // 处理成功情况
    console.log(response);
  })
  .catch((error) => {
    // 处理错误情况
    console.log(error);
  })
  .finally(() => {
    // 总是会执行
})</pre>
      </figure>
      <figure class="code">
        <figcaption>async/await - get</figcaption>
        <pre>
async function getUser() {
  try {
    const response = await axios.get('/user?ID=12345');
    console.log(response);
  } catch (error) {
    console.error(error);
  }
}        </pre>
      </figure>
    </dd>
    <dt>GET 基本过程</dt>
    <dd class="code">
      <pre>
axios.get(baseURL + '/cont')
  .then(res => {
    console.log('res', res);
  })
  .catch(err => {
    console.log('err', err);
  })
  .finally(() => {
    console.log('done for log');
  })</pre>
    </dd>
    <dt>POST 基本过程</dt>
    <dd>默认是json，所以略去了请求头header</dd>
    <dd class="code">
      <pre>
axios.post(baseURL + '/cont', {
  name: 'dg',
  age: 49,
  rank: 1,
  src: '1.jpg'
})
  .then(res => {
    console.log('res', res);
  })
  .catch(err => {
    console.log('err', err);
  })
  .finally(() => {
    console.log('done for log');
  })      </pre>
    </dd>
    <dt>DELETE 基本过程</dt>
    <dd>根据id删除</dd>
    <dd class="code">
      <pre>
axios.delete(baseURL + '/cont/a606')
  .then(res => {
    console.log(res);
  })
  .catch(err => {
    console.log('err', err);
  })
  .finally(() => {
    console.log('done for log');
  })</pre>
    </dd>
    <dt>PATCH 基本过程</dt>
    <dd>根据id和数据完成修改</dd>
    <dd class="code">
      <pre>
axios.patch(baseURL + '/cont/2147', {
  rank: 10
})
  .then(res => {
    console.log(res);
  })
  .catch(err => {
    console.log('err', err);
  })
  .finally(() => {
    console.log('done for log');
  })      </pre>
    </dd>
  </dl>
  <div class="chap">趣味应用 application</div>
  <dl>
    <dd class="example-sn">获取远程数据 - <button id="getDog">点击获取小狗</button></dd>
    <dd id="dog">
      <img src="" alt="">
    </dd>
    <dd class="example-sn">获取远程数据 - <button id='axios-re'>点击获取土味情话</button></dd>
    <div id="axios-remote"></div>
    <dd class="example-sn">获取本地数据 - <button id='axios'>点击获取WEB知识体系</button></dd>
    <dd>1. 如何渲染获取到的数据？使用新节点？使用innerHtml？</dd>
    <dd>2. 表格&lt;table&gt;的使用：使用默认表格还是特别指定表头&lt;thead&gt;和表体&lt;tbody&gt;？</dd>
    <dd class="tbl-box">
      <table class="tbl" cellpadding='6'>
        <thead>
          <tr>
            <th>序号</th>
            <th>内容</th>
            <th>难度</th>
          </tr>
        </thead>
        <tbody id="axios-local"></tbody>
      </table>
    </dd>
    <dd class="code">
      <pre>
//使用节点
for (let i = 0; i &lt; res.data.length; i++) {
let tr = document.createElement('tr')
for (let item in res.data[i]) {
    let td = document.createElement('td')
    td.innerHTML = res.data[i][item]
    tr.appendChild(td)
}
axiosLocal.appendChild(tr)
}</pre>
    </dd>
    <dd class="code">
      <pre>
//使用innerHtml
for (let i = 0; i &lt; res.data.length; i++) {
let tr = '<tr>'
for (let item in res.data[i]) {
    tr += '<td>' + res.data[i][item] + '</td>'
}
tr += '</tr>'
axiosLocal.innerHTML += tr
}</pre>
    </dd>
    <dt>推荐资源 links</dt>
    <dd>1. <a href="https://dog.ceo/api/breed/pembroke/images/random" class="link">随机小狗</a></dd>
    <dd>2. <a href="https://picsum.photos/" class="link">随机图片</a></dd>
    <dd>3. <a href="https://api.uomg.com/api/rand.qinghua?format=json" class="link">土味情话</a></dd>
    <dd>4. http://ajax-base-api-t.itheima.net/api</dd>
    <dd>/getbooks</dd>
    <dd>/addbook</dd>
  </dl>
  <iframe src="../common/footer.html" frameborder="0" scrolling="no" title="footer" id="footer"></iframe>
  <!-- <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script> -->
  <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.6.7/axios.min.js"
    integrity="sha512-NQfB/bDaB8kaSXF8E77JjhHG5PM6XVRxvHzkZiwl3ddWCEPBa23T76MuWSwAJdMGJnmQqM0VeY9kFszsrBEFrQ=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script> -->
  <script src="https://cdn.bootcdn.net/ajax/libs/axios/1.5.0/axios.min.js"></script>
  <script>
    // remote - dog
    let getDog = document.querySelector('#getDog')
    let dog = document.querySelector('#dog img')
    getDog.addEventListener('click', getDogFn)
    async function getDogFn() {
      let res = await axios('https://dog.ceo/api/breed/pembroke/images/random')
      dog.src = res.data.message
    }
    getDogFn()
    // remote - 土味情话
    let axiosR = document.querySelector('#axios-re')
    let axiosRe = document.querySelector('#axios-remote')
    axiosR.addEventListener('click', getQinghua)
    function getQinghua() {
      axiosRe.innerHTML = ''
      axios
        // .get('https://api.apiopen.top/getJoke?page=1&count=10&type=text')
        .get('https://api.uomg.com/api/rand.qinghua?format=json')
        .then(res => {
          axiosRe.innerHTML = res.data.content
        })
    }
    getQinghua()
    // local
    let axiosL = document.querySelector('#axios')
    let axiosLocal = document.querySelector('#axios-local')
    axiosL.addEventListener('click', () => {
      axiosLocal.innerHTML = ''
      axios
        .get('../../data/data2021/stu.json')
        .then(res => {
          for (let i = 0; i < res.data.length; i++) {
            let tr = document.createElement('tr')
            for (let item in res.data[i]) {
              let td = document.createElement('td')
              td.innerHTML = res.data[i][item]
              tr.appendChild(td)
            }
            axiosLocal.appendChild(tr)
          }
          // for (let i = 0; i < res.data.length; i++) {
          //   let tr = '<tr>'
          //   for (let item in res.data[i]) {
          //     tr += '<td>' + res.data[i][item] + '</td>'
          //   }
          //   tr += '</tr>'
          //   axiosLocal.innerHTML += tr
          // }
        })
    })
  </script>
</body>

</html>