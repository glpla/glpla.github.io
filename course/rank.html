<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>积分榜 Rank</title>
  <link rel="stylesheet" href="./css/rank.css">
</head>

<body>
  <div class="container" id="app">
    <nav>
      <div class="nav" :class="{active:isShow}" v-for="(item,ind) in navs" :key="item,url">
        <div class="nav-item">{{item.year}}</div>
        <div class="sub-nav">
          <div class="sub-nav-item" v-for="(item,ind) in item.major" :key="item.url" @click="getData(item.url)">
            {{item.name}}</div>
        </div>
      </div>
      <div class="logo">
        <span class='iconfont icon-line-medalxunzhang-02 logo-icon'></span>
        <span class="logo-title">积分榜 <span class='iconfont icon-line-medalxunzhang-02'></span></span>
      </div>
    </nav>
    <div class="main">
      <div class="left"></div>
      <div id="main">
        <div class="title">{{title}}</div>
        <div class="item" v-for="(item,ind) in rank.cont" :key="item">
          <div>{{item.usn}}</div>
          <img class='img' :src="`/utils${item.uavatar}`" alt="avatar">
          <span class='name'>{{item.uname}}</span>
          <div><span class='iconfont icon-star' v-for="star in item.ucredit"></span></div>
        </div>
      </div>
    </div>
    <footer>
      <h5>All Rights Reserved &copy; By Cnplaman 2022-2024</h5>
    </footer>
  </div>
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <script>
    const { createApp, ref, computed, onMounted } = Vue
    createApp({
      setup() {
        const navs = ref([
          {
            year: '2023',
            major: [
              {
                name: '22软工',
                url: '202301.json'
              },
              {
                name: '23经济和语言',
                url: '202302.json'
              },
              {
                name: '23服装',
                url: '202303.json'
              },
              {
                name: '23播音网络',
                url: '202304.json'
              }
            ]
          },
          {
            year: '2024',
            major: [
              {
                name: '22软工',
                url: '202401.json'
              },
              {
                name: '22数媒',
                url: '202402.json'
              }
            ]
          }
        ])
        const ind = ref(0)
        const isShow = ref(false)
        const title = ref('请选择...')
        const rank = ref([]);
        const getData = (url) => {
          // isShow.value = true;
          // console.log(url, isShow.value);
          fetch(`/utils/data/rank/${url}`)
            .then(res => res.json())
            .then(res => {
              console.log(res);
              rank.value = res;
              title.value = `${res.info.grade} ${res.info.major} ${res.info.course}`
              // isShow.value = false;
              // console.log(url, isShow.value);
            })
        }
        onMounted(() => {
          console.log('hi');
        })
        return {
          ind,
          isShow,
          navs,
          rank,
          title,
          getData
        }
      }
    }).mount('#app')</script>
  <!-- <script>
    let main = document.querySelector('#main');
    let tab = document.querySelectorAll('.tab-item')
    tab.forEach((item, ind) => {
      item.addEventListener('click', () => {
        loadData(`../utils/data/data2024/rank20240${ind + 1}.json`);
        tab.forEach(item => {
          item.classList.remove('active');
        })
        item.classList.toggle('active');
      })
    })
    loadData('../utils/data/data2024/rank202401.json')
    function loadData(url) {
      let stu = [];
      let str = '';
      let iconStr = "<span class='iconfont icon-star'></span>"
      fetch(url)
        .then(res => res.json())
        .then(res => {
          stu = [...res.cont];
          stu.sort((a, b) => { return b.ucredit - a.ucredit; })
          let str = stu.map((item, ind) => {
            return `<div class='item' style='--star:${item.ucredit}'>
          <span class='sn'>${item.usn}</span>
          <img class='img' src="../utils${item.uavatar}" alt="avatar">
          <span class='name'>${item.uname}</span>
          <div>${iconStr.repeat(item.ucredit)}</div>          
         </div>
          `
          }).join('')
          main.innerHTML = str;
        })
    }
    console.log('hi'.repeat(2));
  </script> -->
</body>

</html>